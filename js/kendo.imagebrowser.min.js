/*
* Kendo UI Web v2012.3.1114 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-web-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
(function(e,t){function a(e,t,a){var i,r;e.on("dragenter"+_,function(){t(),r=new Date,i||(i=setInterval(function(){var e=new Date-r;e>100&&(a(),clearInterval(i),i=null)},100))}).on("dragover"+_,function(){r=new Date})}function i(e,t){var a=e[t];return l(a)?a.field||t:a}function r(e,a){return e!==t&&e.match(/\/$/)||(e=(e||"")+"/"),e+a}function n(e){if(!e)return"";var t=" bytes";return e>=1073741824?(t=" GB",e/=1073741824):e>=1048576?(t=" MB",e/=1048576):e>=1024&&(t=" KB",e/=1024),Math.round(100*e)/100+t}var o=window.kendo,s=o.ui.Widget,l=e.isPlainObject,d=e.proxy,u=e.extend,c=o.support.placeholder,p=e.isFunction,f=/(^\/|\/$)/g,h="change",m="apply",g="error",v="click",_=".kendoImageBrowser",k=".kendoBreadcrumbs",b=".kendoSearchBox",w="name",y="size",F="type",S={field:F,dir:"asc"},N=o.template('<li data-#=ns#value="#=value#" class="k-item">${text}</li>'),x=o.template('<li class="k-tile-empty"><strong>${text}</strong></li>'),B='<div class="k-widget k-toolbar k-floatwrap"><div class="k-toolbar-wrap">#if(showUpload) { # <div class="k-widget k-upload"><div class="k-button k-button-icontext k-button-bare k-upload-button"><span class="k-icon k-add"></span>#=messages.uploadFile#<input type="file" name="file" /></div></div>#}##if(showCreate) {#<button type="button" class="k-button k-button-icon k-button-bare"><span class="k-icon k-addfolder"></span></button>#}##if(showDelete) {#<button type="button" class="k-button k-button-icon k-button-bare k-state-disabled"><span class="k-icon k-delete"></span></button>&nbsp;#}#</div><div class="k-tiles-arrange">#=messages.orderBy#: <a href="\\#" class="k-link"><span>#=messages.orderByName#</span><span class="k-icon k-i-arrow-s"></span></a></div></div>';u(!0,o.data,{schemas:{imagebrowser:{data:function(e){return e.items||e||[]},model:{id:"name",fields:{name:"name",size:"size",type:"type"}}}}}),u(!0,o.data,{transports:{imagebrowser:o.data.RemoteTransport.extend({init:function(t){o.data.RemoteTransport.fn.init.call(this,e.extend(!0,{},this.options,t))},_call:function(t,a){a.data=e.extend({},a.data,{path:this.options.path()}),p(this.options[t])?this.options[t].call(this,a):o.data.RemoteTransport.fn[t].call(this,a)},read:function(e){this._call("read",e)},create:function(e){this._call("create",e)},destroy:function(e){this._call("destroy",e)},update:function(){},options:{read:{type:"POST"},update:{type:"POST"},create:{type:"POST"},destroy:{type:"POST"}}})}});var T;T=e.browser.msie&&8>parseFloat(e.browser.version)?function(e){return e.offsetTop}:function(t){return t.offsetTop-e(t).height()};var C=s.extend({init:function(e,t){var a=this;t=t||{},s.fn.init.call(a,e,t),a.element.addClass("k-imagebrowser"),a.element.on(v+_,".k-toolbar button:not(.k-state-disabled):has(.k-delete)",d(a._deleteClick,a)).on(v+_,".k-toolbar button:not(.k-state-disabled):has(.k-addfolder)",d(a._addClick,a)).on("keydown"+_,"li.k-state-selected input",d(a._directoryKeyDown,a)).on("blur"+_,"li.k-state-selected input",d(a._directoryBlur,a)),a._dataSource(),a.refresh(),a.path(a.options.path)},options:{name:"ImageBrowser",messages:{uploadFile:"Upload",orderBy:"Arrange by",orderByName:"Name",orderBySize:"Size",directoryNotFound:"A directory with this name was not found.",emptyFolder:"Empty Folder",deleteFile:'Are you sure you want to delete "{0}"?',invalidFileType:'The selected file "{0}" is not valid. Supported file types are {1}.',overwriteFile:'A file with name "{0}" already exists in the current directory. Do you want to overwrite it?',dropFilesHere:"drop files here to upload"},transport:{},path:"/",fileTypes:"*.png,*.gif,*.jpg,*.jpeg"},events:[g,h,m],destroy:function(){var e=this;s.fn.destroy.call(e),e.dataSource.unbind(g,e._errorHandler),e.element.add(e.list).add(e.toolbar).off(_),e.arrangeByPopup&&e.arrangeByPopup.destroy(),o.destroy(e.element)},value:function(){var e,a=this,i=a._selectedItem(),n=a.options.transport.imageUrl;return i&&"f"===i.get(a._getFieldName(F))?(e=r(a.path(),i.get(a._getFieldName(w))).replace(f,""),n&&(e=p(n)?n(e):o.format(n,e)),e):t},_selectedItem:function(){var e=this.listView,a=e.select();return a.length?this.dataSource.getByUid(a.attr(o.attr("uid"))):t},_toolbar:function(){var t,a,i=this,r=o.template(B),n=i.options.messages,s=[{text:n.orderByName,value:"name",ns:o.ns},{text:n.orderBySize,value:"size",ns:o.ns}];i.toolbar=e(r({messages:n,showUpload:i.options.transport.uploadUrl,showCreate:i.options.transport.create,showDelete:i.options.transport.destroy})).appendTo(i.element).find(".k-upload input").kendoUpload({multiple:!1,localization:{dropFilesHere:n.dropFilesHere},async:{saveUrl:i.options.transport.uploadUrl,autoUpload:!0},upload:d(i._fileUpload,i)}).end(),i.upload=i.toolbar.find(".k-upload input").data("kendoUpload"),t=i.toolbar.find(".k-tiles-arrange a"),i.arrangeByPopup=a=e("<ul>"+o.render(N,s)+"</ul>").kendoPopup({anchor:t}).on(v+_,"li",function(){var t=e(this),r=t.attr(o.attr("value"));i.toolbar.find(".k-tiles-arrange a span:first").html(t.text()),a.close(),i.orderBy(r)}).data("kendoPopup"),t.on(v+_,function(e){e.preventDefault(),a.toggle()}),i._attachDropzoneEvents()},_attachDropzoneEvents:function(){var t=this;t.options.transport.uploadUrl&&(a(e(document.documentElement),e.proxy(t._dropEnter,t),e.proxy(t._dropLeave,t)),t._scrollHandler=d(t._positionDropzone,t))},_dropEnter:function(){this._positionDropzone(),e(document).on("scroll"+_,this._scrollHandler)},_dropLeave:function(){this._removeDropzone(),e(document).off("scroll"+_,this._scrollHandler)},_positionDropzone:function(){var e=this,t=e.element,a=t.offset();e.toolbar.find(".k-dropzone").addClass("k-imagebrowser-dropzone").offset(a).css({width:t[0].clientWidth,height:t[0].clientHeight,lineHeight:t[0].clientHeight+"px"})},_removeDropzone:function(){this.toolbar.find(".k-dropzone").removeClass("k-imagebrowser-dropzone").css({width:"",height:"",lineHeight:"",top:"",left:""})},_deleteClick:function(){var e=this,t=e.listView.select(),a=o.format(e.options.messages.deleteFile,t.find("strong").text());t.length&&e._showMessage(a,"confirm")&&e.listView.remove(t)},_addClick:function(){this.createDirectory()},_fileUpload:function(e){var t,a=this,i=a.options,r=i.fileTypes,n=RegExp(("("+r.split(",").join(")|(")+")").replace(/\*\./g,".*."),"i"),s=e.files[0].name,l=a._getFieldName(w),d=a._getFieldName(y);n.test(s)?(e.data={path:a.path()},t=a._createFile(s),t?a.upload.one("success",function(e){t.set(l,e.response[l]),t.set(d,e.response[d]),a._tiles=a.listView.items().filter("["+o.attr("type")+"=f]")}):e.preventDefault()):(e.preventDefault(),a._showMessage(o.format(i.messages.invalidFileType,s,r)))},_findFile:function(e){var t,a,i,r=this.dataSource.data(),n=this._getFieldName(F),o=this._getFieldName(w);for(e=e.toLowerCase(),t=0,i=r.length;i>t;t++)if("f"===r[t].get(n)&&r[t].get(o).toLowerCase()===e){a=r[t];break}return a},_createFile:function(e){var t,a,i=this,r=0,n={},s=i._getFieldName(F),l=i.dataSource.view(),d=i._findFile(e);if(d&&!i._showMessage(o.format(i.options.messages.overwriteFile,e),"confirm"))return null;if(d)return d;for(t=0,a=l.length;a>t;t++)if("f"===l[t].get(s)){r=t;break}return n[s]="f",n[i._getFieldName(w)]=e,n[i._getFieldName(y)]=0,i.dataSource.insert(++r,n)},createDirectory:function(){var e,t,a=this,i=0,r=a._getFieldName(F),n=a._getFieldName(w),s=a.dataSource.data(),l=a._nameDirectory(),d=new a.dataSource.reader.model;for(e=0,t=s.length;t>e;e++)"d"===s[e].get(r)&&(i=e);d.set(r,"d"),d.set(n,l),a.listView.one("dataBound",function(){var e=a.listView.items().filter("["+o.attr("uid")+"="+d.uid+"]"),t=e.find("input");e.length&&this.edit(e),this.element.scrollTop(e.attr("offsetTop")-this.element[0].offsetHeight),setTimeout(function(){t.select()})}).one("save",function(e){var t=e.model.get(n);t?e.model.set(n,a._nameExists(t,d.uid)?a._nameDirectory():t):e.model.set(n,l)}),a.dataSource.insert(++i,d)},_directoryKeyDown:function(e){13==e.keyCode&&e.currentTarget.blur()},_directoryBlur:function(){this.listView.save()},_nameExists:function(e,t){var a,i,r=this.dataSource.data(),n=this._getFieldName(F),o=this._getFieldName(w);for(a=0,i=r.length;i>a;a++)if("d"===r[a].get(n)&&r[a].get(o).toLowerCase()===e.toLowerCase()&&r[a].uid!==t)return!0;return!1},_nameDirectory:function(){var t,a,i,r="New folder",n=this.dataSource.data(),o=[],s=this._getFieldName(F),l=this._getFieldName(w);for(a=0,i=n.length;i>a;a++)"d"===n[a].get(s)&&n[a].get(l).toLowerCase().indexOf(r.toLowerCase())>-1&&o.push(n[a].get(l));if(e.inArray(r,o)>-1){a=2;do t=r+" ("+a+")",a++;while(e.inArray(t,o)>-1);r=t}return r},orderBy:function(e){this.dataSource.sort([{field:this._getFieldName(F),dir:"asc"},{field:this._getFieldName(e),dir:"asc"}])},search:function(e){this.dataSource.filter({field:this._getFieldName(w),operator:"contains",value:e})},_content:function(){var t=this;t.list=e('<ul class="k-reset k-floats k-tiles" />').appendTo(t.element).on("scroll"+_,d(t._scroll,t)).on("dblclick"+_,"li",d(t._dblClick,t)),t.listView=new o.ui.ListView(t.list,{dataSource:t.dataSource,template:t._itemTmpl(),editTemplate:t._editTmpl(),selectable:!0,autoBind:!1,dataBinding:function(e){t.toolbar.find(".k-delete").parent().addClass("k-state-disabled"),("remove"===e.action||"sync"===e.action)&&e.preventDefault()},dataBound:function(){t.dataSource.view().length?(t._tiles=this.items().filter("["+o.attr("type")+"=f]"),t._scroll()):this.wrapper.append(x({text:t.options.messages.emptyFolder}))},change:d(t._listViewChange,t)})},_dblClick:function(t){var a=this,i=e(t.currentTarget);if(i.filter("["+o.attr("type")+"=d]").length){var n=a.dataSource.getByUid(i.attr(o.attr("uid")));n&&(a.path(r(a.path(),n.get(a._getFieldName(w)))),a.breadcrumbs.value(a.path()))}else i.filter("["+o.attr("type")+"=f]").length&&a.trigger(m)},_listViewChange:function(){var e=this._selectedItem();this.toolbar.find(".k-delete").parent().removeClass("k-state-disabled"),e&&"f"===e.get(this._getFieldName(F))&&this.trigger(h)},_dataSource:function(){var e,t=this,a=t.options,r=a.transport,n=u({},S),s={field:w,dir:"asc"},c={type:r.type||"imagebrowser",sort:[n,s]};l(r)&&(r.path=d(t.path,t),c.transport=r),l(a.schema)?(c.schema=a.schema,l(a.schema.model)&&a.schema.model.fields&&(n.field=i(a.schema.model.fields,F),s.field=i(a.schema.model.fields,w))):r.type&&l(o.data.schemas[r.type])&&(e=o.data.schemas[r.type],l(e.model)&&e.model.fields&&(n.field=i(e.model.fields,F),s.field=i(e.model.fields,w))),t.dataSource&&t._errorHandler?t.dataSource.unbind(g,t._errorHandler):t._errorHandler=d(t._error,t),t.dataSource=o.data.DataSource.create(c).bind(g,t._errorHandler)},_navigation:function(){var t=this,a=e('<div class="k-floatwrap"><input/><input/></div>').appendTo(this.element);t.breadcrumbs=a.find("input:first").kendoBreadcrumbs({value:t.options.path,change:function(){t.path(this.value())}}).data("kendoBreadcrumbs"),t.searchBox=a.parent().find("input:last").kendoSearchBox({change:function(){t.search(this.value())}}).data("kendoSearchBox")},_error:function(e){var t,a=this;a.trigger(g,e)||(t=e.xhr.status,"error"==e.status?"404"==t?a._showMessage(a.options.messages.directoryNotFound):"0"!=t&&a._showMessage("Error! The requested URL returned "+t+" - "+e.xhr.statusText):"timeout"==t&&a._showMessage("Error! Server timeout."))},_showMessage:function(e,t){return window[t||"alert"](e)},refresh:function(){var e=this;e._navigation(),e._toolbar(),e._content()},_loadImage:function(t){var a=this,i=e(t),r=a.dataSource.getByUid(i.attr(o.attr("uid"))),n=r.get(a._getFieldName(w)),s=e("<img />",{alt:n}).hide().on("load"+_,function(){e(this).prev().remove().end().addClass("k-image").fadeIn()});i.find(".k-loading").after(s),s.attr("src",a.options.transport.thumbnailUrl+"?path="+a.path()+encodeURIComponent(n)),t.loaded=!0},_scroll:function(){var e=this;e.options.transport&&e.options.transport.thumbnailUrl&&(clearTimeout(e._timeout),e._timeout=setTimeout(function(){var a=e.list.outerHeight(),i=e.list.scrollTop(),r=i+a;e._tiles.each(function(){var a=T(this),n=a+this.offsetHeight;return(a>=i&&r>a||n>=i&&r>n)&&e._loadImage(this),a>r?!1:t}),e._tiles=e._tiles.filter(function(){return!this.loaded})},250))},_editTmpl:function(){var e=this,t='<li class="k-tile k-state-selected" '+o.attr("uid")+'="#=uid#" ';return t+=o.attr("type")+'="${'+e._getFieldName(F)+'}">',t+="#if("+e._getFieldName(F)+' == "d") { #',t+='<div class="k-thumb"><span class="k-icon k-folder"></span></div>',t+="#}else{#",t+='<div class="k-thumb"><span class="k-icon k-loading"></span></div>',t+="#}#",t+="#if("+e._getFieldName(F)+' == "d") { #',t+='<input class="k-input" '+o.attr("bind")+'="value:'+e._getFieldName(w)+'"/>',t+="#}#",t+="</li>",d(o.template(t),{sizeFormatter:n})},_itemTmpl:function(){var e=this,t='<li class="k-tile" '+o.attr("uid")+'="#=uid#" ';return t+=o.attr("type")+'="${'+e._getFieldName(F)+'}">',t+="#if("+e._getFieldName(F)+' == "d") { #',t+='<div class="k-thumb"><span class="k-icon k-folder"></span></div>',t+="#}else{#",t+=e.options.transport&&e.options.transport.thumbnailUrl?'<div class="k-thumb"><span class="k-icon k-loading"></span></div>':'<div class="k-thumb"><span class="k-icon k-file"></span></div>',t+="#}#",t+="<strong>${"+e._getFieldName(w)+"}</strong>",t+="#if("+e._getFieldName(F)+' == "f") { # <span class="k-filesize">${this.sizeFormatter('+e._getFieldName(y)+")}</span> #}#",t+="</li>",d(o.template(t),{sizeFormatter:n})},_getFieldName:function(e){return i(this.dataSource.reader.model.fields,e)},path:function(e){var a=this,i=a._path||"";return e!==t?(a._path=e.replace(f,"")+"/",a.dataSource.read({path:a._path}),t):(i&&(i=i.replace(f,"")),"/"===i||""===i?"":i+"/")}}),D=s.extend({init:function(e,t){var a=this;t=t||{},s.fn.init.call(a,e,t),c&&a.element.attr("placeholder",a.options.label),a._wrapper(),a.element.on("keydown"+b,d(a._keydown,a)).on("change"+b,d(a._updateValue,a)),a.wrapper.on(v+b,"a",d(a._click,a)),c||a.element.on("focus"+b,d(a._focus,a)).on("blur"+b,d(a._blur,a))},options:{name:"SearchBox",label:"Search",value:""},events:[h],destroy:function(){var e=this;e.wrapper.add(e.element).add(e.label).off(b),s.fn.destroy.call(e)},_keydown:function(e){13===e.keyCode&&this._updateValue()},_click:function(e){e.preventDefault(),this._updateValue()},_updateValue:function(){var e=this,t=e.element.val();t!==e.value()&&(e.value(t),e.trigger(h))},_blur:function(){this._updateValue(),this._toggleLabel()},_toggleLabel:function(){c||this.label.toggle(!this.element.val())},_focus:function(){this.label.hide()},_wrapper:function(){var t=this.element,a=t.parents(".k-search-wrap");t[0].style.width="",t.addClass("k-input k-textbox"),a.length||(a=t.wrap(e('<div class="k-widget k-search-wrap k-textbox"/>')).parent(),c||e('<label style="display:block">'+this.options.label+"</label>").insertBefore(t),e('<a href="#" class="k-icon k-i-search k-search"/>').appendTo(a)),this.wrapper=a,this.label=a.find(">label")},value:function(e){var a=this;return e!==t?(a.options.value=e,a.element.val(e),a._toggleLabel(),t):a.options.value}}),z=s.extend({init:function(e,t){var a=this;t=t||{},s.fn.init.call(a,e,t),a._wrapper(),a.wrapper.on("focus"+k,"input",d(a._focus,a)).on("blur"+k,"input",d(a._blur,a)).on("keydown"+k,"input",d(a._keydown,a)).on(v+k,"a.k-i-arrow-n:first",d(a._rootClick,a)).on(v+k,"a:not(.k-i-arrow-n)",d(a._click,a)),a.value(a.options.value)},options:{name:"Breadcrumbs",gap:50},events:[h],destroy:function(){var e=this;s.fn.destroy.call(e),e.wrapper.add(e.wrapper.find("input")).add(e.wrapper.find("a")).off(k)},_update:function(e){e="/"===(e||"").charAt(0)?e:"/"+(e||""),e!==this.value()&&(this.value(e),this.trigger(h))},_click:function(t){t.preventDefault(),this._update(this._path(e(t.target).prevAll("a:not(.k-i-arrow-n)").andSelf()))},_rootClick:function(e){e.preventDefault(),this._update("")},_focus:function(){var e=this,t=e.element;e.overlay.hide(),e.element.val(e.value()),setTimeout(function(){t.select()})},_blur:function(){if(!this.overlay.is(":visible")){var e=this,t=e.element,a=t.val().replace(/\/{2,}/g,"/");e.overlay.show(),t.val(""),e._update(a)}},_keydown:function(e){var t=this;13===e.keyCode&&(t._blur(),setTimeout(function(){t.overlay.find("a:first").focus()}))},_wrapper:function(){var t,a=this.element,i=a.parents(".k-breadcrumbs");a[0].style.width="",a.addClass("k-input"),i.length||(i=a.wrap(e('<div class="k-widget k-breadcrumbs k-header k-state-default"/>')).parent()),t=i.find(".k-breadcrumbs-wrap"),t.length||(t=e('<div class="k-breadcrumbs-wrap"/>').appendTo(i)),this.wrapper=i,this.overlay=t},refresh:function(){var a,i,r,n,o="",s=this.value();for(s!==t&&s.match(/^\//)||(s="/"+(s||"")),a=s.split("/"),r=0,n=a.length;n>r;r++)i=a[r],i&&(o||(o+='<a href="#" class="k-icon k-i-arrow-n">root</a>'),o+='<a class="k-link" href="#">'+a[r]+"</a>",o+='<span class="k-icon k-i-arrow-e">&gt;</span>');this.overlay.empty().append(e(o)),this._adjustSectionWidth()},_adjustSectionWidth:function(){var t,a=this,i=a.wrapper,r=i.width()-a.options.gap,n=a.overlay.find("a");n.each(function(a){t=e(this),t.parent().width()>r&&(a==n.length-1?t.width(r):t.prev().andSelf().hide())})},value:function(e){return e!==t?(this._value=e.replace(/\/{2,}/g,"/"),this.refresh(),t):this._value},_path:function(t){return"/"+e.map(t,function(t){return e(t).text()}).join("/")}});o.ui.plugin(C),o.ui.plugin(z),o.ui.plugin(D)})(window.kendo.jQuery);